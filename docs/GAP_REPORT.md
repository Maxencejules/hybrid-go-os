# G2 Gap Report (Rugo Lane)

- [ ] **P1 - Unified user-copy not fully applied to pointer syscalls**: `sys_debug_write` (`kernel_rs/src/lib.rs:537`, raw user deref at `kernel_rs/src/lib.rs:567`), `sys_blk_read` (`kernel_rs/src/lib.rs:1708`, raw copyout at `kernel_rs/src/lib.rs:1735`), `sys_blk_write` (`kernel_rs/src/lib.rs:1742`, raw copyin at `kernel_rs/src/lib.rs:1765`), `sys_net_send` (`kernel_rs/src/lib.rs:2566`, raw copyin at `kernel_rs/src/lib.rs:2574`), and `sys_net_recv` (`kernel_rs/src/lib.rs:2582`, raw copyout at `kernel_rs/src/lib.rs:2591`) bypass unified `copyin_user`/`copyout_user` (`kernel_rs/src/lib.rs:792`, `kernel_rs/src/lib.rs:808`) despite ABI contract text claiming uniform copy layer (`docs/abi/syscall_v0.md:125`, `docs/abi/syscall_v0.md:137`).

- [ ] **P2 - IPC semantics still have undefined/silent-overwrite behaviors**: `sys_ipc_recv` uses a single waiter slot (`waiter: i32`) and unconditionally writes `R4_ENDPOINTS[ep].waiter = R4_CURRENT as i32` (`kernel_rs/src/lib.rs:1122`, `kernel_rs/src/lib.rs:1213`), so a second waiter can overwrite the first waiter state silently; `sys_ipc_send` also silently truncates (`len > 256` clamp at `kernel_rs/src/lib.rs:1146`, delivery clamp at `kernel_rs/src/lib.rs:1158`). Existing test marker only covers occupied-slot behavior (`"IPC: full ok"` at `tests/ipc/test_ipc_buffer_full.py:7`, blob marker at `kernel_rs/src/lib.rs:2086`).

- [ ] **P3 - Service registry endpoint-validity semantics are undefined**: overwrite/full-table mechanics are present (`R4_MAX_SERVICES=4`, overwrite path in `sys_svc_register` at `kernel_rs/src/lib.rs:1234`, `kernel_rs/src/lib.rs:1257`) and covered by markers (`"SVC: overwrite ok"` in `tests/ipc/test_svc_overwrite.py:7`, `"SVC: full ok"` in `tests/ipc/test_svc_full.py:7`), but `sys_svc_register` stores `endpoint` without validating endpoint existence/activeness (`kernel_rs/src/lib.rs:1262`, `kernel_rs/src/lib.rs:1272`), leaving registry target semantics undefined.

- [ ] **P4 - VirtIO blk invariant failure paths are not tested**: init hardening checks exist (`qsz == 0` and layout bound `used_end_ck > vq_buf_size` at `kernel_rs/src/lib.rs:1568`, `kernel_rs/src/lib.rs:1581`), but acceptance test validates only success marker `"BLK: invariants ok"` (`tests/drivers/test_virtio_blk_init_invariants.py:7`) and does not exercise failure marker `"BLK: init failed"` (`kernel_rs/src/lib.rs:3162`) for malformed queue-size/layout conditions.

- [ ] **P5 - TinyGo dependency contract is ambiguous for full test entrypoint**: full suite target `test-qemu` includes `image-go` (`Makefile:317`) which requires `build-go`/TinyGo (`Makefile:306`), while build guide still labels Go/TinyGo as `CI & Docker only` (`docs/BUILD.md:84`). CI currently installs TinyGo (`.github/workflows/ci.yml:30`, `.github/workflows/ci.yml:39`), but local readiness contract is inconsistent.
